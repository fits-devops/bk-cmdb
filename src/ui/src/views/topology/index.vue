<template>
    <div class="topology-layout clearfix">
        <cmdb-resize-layout class="tree-layout fl"
            v-bkloading="{ isLoading: $loading([`get_getInstTopo_${business}`, `get_getInternalTopo_${business}`]) }"
            direction="right"
            :handler-offset="3"
            :min="200"
            :max="480">
            <cmdb-tree ref="topoTree" class="topo-tree"
                children-key="child"
                :id-generator="getTopoNodeId"
                :tree="tree.data"
                @on-selected="handleNodeSelected">
                <div class="tree-node clearfix" slot-scope="{ node, state }"
                    :class="{
                        'tree-node-selected': state.selected,
                        'tree-node-module': node['obj_id'] === 'module'
                    }">
                    <template v-if="[1, 2].includes(node.default)">
                        <i class="topo-node-icon topo-node-icon-internal icon-cc-host-free-pool" v-if="node.default === 1"></i>
                        <i class="topo-node-icon topo-node-icon-internal icon-cc-host-breakdown" v-else></i>
                    </template>
                    <i class="topo-node-icon topo-node-icon-text" v-else>{{node['obj_name'][0]}}</i>
                    <span class="topo-node-text" :title="node['inst_name']">{{node['inst_name']}}</span>
                    <bk-button type="primary" class="topo-node-btn-create fr"
                        v-if="showCreate(node, state)"
                        @click.stop="handleCreate">
                        {{$t('Common[\'新建\']')}}
                    </bk-button>
                </div>
            </cmdb-tree>
            <bk-dialog
                :is-show.sync="tree.create.showDialog"
                :has-header="false"
                :has-footer="false"
                :padding="0"
                :quick-close="false"
                @after-transition-leave="handleAfterCancelCreateNode"
                @cancel="handleCancelCreateNode">
                <tree-node-create v-if="tree.create.active" slot="content"
                    :properties="tree.create.properties"
                    :state="tree.selectedNodeState"
                    @on-submit="handleCreateNode"
                    @on-cancel="handleCancelCreateNode">
                </tree-node-create>
            </bk-dialog>
        </cmdb-resize-layout>
        <div class="hosts-layout">
            <bk-tab :active-name.sync="tab.active" @tab-changed="handleTabChanged">
                <bk-tabpanel class="topo-tabpanel" name="hosts" :title="$t('BusinessTopology[\'主机调配\']')">
                    <bk-button class="topo-table-btn-refresh" type="primary" style="display: none;"
                        :disabled="$loading()"
                        @click="handleRefresh">
                        {{$t("HostResourcePool['刷新查询']")}}
                    </bk-button>
                    <cmdb-hosts-table class="topo-table" ref="topoTable"
                        delete-auth=""
                        :save-auth="$OPERATION.U_HOST"
                        :edit-auth="$OPERATION.U_HOST"
                        :transfer-resource-auth="$OPERATION.HOST_TO_RESOURCE"
                        :columns-config-key="columnsConfigKey"
                        :columns-config-properties="columnsConfigProperties"
                        :quick-search="true"
                        @on-quick-search="handleQuickSearch">
                    </cmdb-hosts-table>
                </bk-tabpanel>
                <bk-tabpanel name="attribute" :title="$t('BusinessTopology[\'节点属性\']')"
                    v-bkloading="{ isLoading: $loading() }"
                    :show="showAttributePanel">
                    <cmdb-details class="topology-details"
                        v-if="isNodeDetailsActive"
                        :show-delete="false"
                        :show-options="!isAdminView"
                        :properties="tab.properties"
                        :property-groups="tab.propertyGroups"
                        :inst="tree.flatternedSelectedNodeInst"
                        @on-edit="handleEdit">
                    </cmdb-details>
                    <cmdb-form class="topology-details" v-else-if="['update', 'create'].includes(tab.type)"
                        :properties="tab.properties"
                        :property-groups="tab.propertyGroups"
                        :inst="tree.selectedNodeInst"
                        :type="tab.type"
                        @on-submit="handleSubmit"
                        @on-cancel="handleCancel">
                        <template slot="extra-options">
                            <bk-button type="danger" style="margin-left: 4px" @click="handleDelete">{{$t('Common["删除"]')}}
                            </bk-button>
                        </template>
                    </cmdb-form>
                </bk-tabpanel>
                <bk-tabpanel name="process" :title="$t('ProcessManagement[\'进程信息\']')"
                    :show="showProcessPanel">
                    <cmdb-topo-node-process
                        v-if="tab.active === 'process'"
                        :business="bizId"
                        :module="tree.selectedNode">
                    </cmdb-topo-node-process>
                </bk-tabpanel>
            </bk-tab>
        </div>
    </div>
</template>

<script>
    import { mapGetters, mapActions } from 'vuex'
    import cmdbHostsTable from '@/components/hosts/table'
    import cmdbTopoNodeProcess from './children/_node-process'
    import treeNodeCreate from './children/_node-create.vue'
    export default {
        components: {
            cmdbHostsTable,
            cmdbTopoNodeProcess,
            treeNodeCreate
        },
        data () {
            return {
                properties: {
                    biz: [],
                    host: [],
                    set: [],
                    module: []
                },
                business: '',
                businessResolver: null,
                businessTopo: [],
                topoModel: [],
                tree: {
                    data: [],
                    selectedNode: null,
                    selectedNodeState: null,
                    selectedNodeInst: {},
                    flatternedSelectedNodeInst: {},
                    internalModule: [],
                    create: {
                        showDialog: false,
                        active: false,
                        properties: []
                    }
                },
                tab: {
                    active: 'hosts',
                    type: 'details',
                    properties: [],
                    propertyGroups: []
                },
                table: {
                    params: null,
                    quickSearch: {
                        property: null,
                        value: '',
                        operator: ''
                    }
                }
            }
        },
        computed: {
            ...mapGetters(['supplierAccount', 'userName', 'isAdminView']),
            ...mapGetters('objectBiz', ['bizId']),
            columnsConfigKey () {
                return `${this.userName}_$topology_${this.isAdminView ? 'adminView' : this.bizId}_table_columns`
            },
            columnsConfigProperties () {
                const setProperties = this.properties.set.filter(property => ['set_name'].includes(property['property_id']))
                const moduleProperties = this.properties.module.filter(property => ['module_name'].includes(property['property_id']))
                const hostProperties = this.properties.host
                return [...setProperties, ...moduleProperties, ...hostProperties]
            },
            showAttributePanel () {
                const selectedNode = this.tree.selectedNode
                if (selectedNode) {
                    const isBusinessNode = selectedNode['obj_id'] === 'biz'
                    const isDefault = !!selectedNode.default
                    const isCreate = this.tab.type === 'create'
                    const isTreeLoaded = !!this.tree.data.length
                    return isTreeLoaded && ((!isBusinessNode && !isDefault) || isCreate)
                }
                return false
            },
            showProcessPanel () {
                const selectedNode = this.tree.selectedNode
                if (selectedNode) {
                    const isDefault = !!selectedNode.default
                    const isModule = selectedNode['obj_id'] === 'module'
                    return !isDefault && isModule
                }
                return false
            },
            isNodeDetailsActive () {
                const isAttributePanel = this.tab.active === 'attribute'
                const isDetails = this.tab.type === 'details'
                return isAttributePanel && isDetails
            }
        },
        watch: {
            business (business) {
                if (this.businessResolver) {
                    this.businessResolver()
                } else {
                    this.getBusinessTopo()
                }
            },
            showAttributePanel (val) {
                if (!val) {
                    this.tab.active = 'hosts'
                }
            },
            showProcessPanel (val) {
                if (!val) {
                    this.tab.active = 'hosts'
                }
            }
        },
        async created () {
            this.$store.commit('setHeaderTitle', this.$t('Nav["业务拓扑"]'))
            try {
                await Promise.all([
                    // this.getBusiness(),
                    this.getProperties()
                ])
                await this.getMainlineModel()
                await this.getBusinessTopo()
            } catch (e) {
                console.log(e)
            }
        },
        methods: {
            ...mapActions('objectModelProperty', [
                'searchObjectAttribute',
                'batchSearchObjectAttribute'
            ]),
            ...mapActions('objectModelFieldGroup', ['searchGroup']),
            ...mapActions('objectSet', [
                'searchSet',
                'createSet',
                'updateSet',
                'deleteSet'
            ]),
            ...mapActions('objectModule', [
                'searchModule',
                'createModule',
                'updateModule',
                'deleteModule'
            ]),
            ...mapActions('objectCommonInst', [
                'searchInst',
                'createInst',
                'updateInst',
                'deleteInst'
            ]),
            ...mapActions('objectMainLineModule', [
                'searchMainlineObject',
                'getInstTopo',
                'getInternalTopo'
            ]),
            getBusiness () {
                return new Promise((resolve, reject) => {
                    this.businessResolver = () => {
                        this.businessResolver = null
                        resolve()
                    }
                })
            },
            getProperties () {
                return this.batchSearchObjectAttribute({
                    params: this.$injectMetadata({
                        obj_id: { '$in': Object.keys(this.properties) },
                        org_id: this.supplierAccount
                    }),
                    config: {
                        requestId: `post_batchSearchObjectAttribute_${Object.keys(this.properties).join('_')}`
                    }
                }).then(result => {
                    Object.keys(this.properties).forEach(objId => {
                        this.properties[objId] = result[objId]
                    })
                    return result
                })
            },
            getCommonProperties (objId) {
                if (this.properties.hasOwnProperty(objId)) {
                    return Promise.resolve(this.properties[objId])
                }
                return this.searchObjectAttribute({
                    params: this.$injectMetadata({
                        'obj_id': objId,
                        'org_id': this.supplierAccount
                    }),
                    config: {
                        requestId: `post_searchObjectAttribute_${objId}`
                    }
                }).then(properties => {
                    this.$set(this.properties, objId, properties)
                    return properties
                })
            },
            getPropertyGroups (objId) {
                this.tab.propertyGroups = []
                this.searchGroup({
                    objId,
                    params: this.$injectMetadata(),
                    config: {
                        requestId: `post_searchGroup_${objId}`
                    }
                }).then(groups => {
                    this.tab.propertyGroups = groups
                    return groups
                })
            },
            getNodeObjPropertyInfo (objId) {
                return Promise.all([
                    this.getPropertyGroups(objId),
                    this.getCommonProperties(objId)
                ])
            },
            getNodeInst () {
                const selectedNode = this.tree.selectedNode
                const objId = selectedNode['obj_id']
                const instId = selectedNode['inst_id']
                const requestParams = {
                    page: { start: 0, limit: 1 },
                    fields: [],
                    condition: {}
                }
                const requestConfig = {
                    cancelPrevious: true
                }
                let promise
                if (objId === 'set') {
                    requestParams.condition['set_id'] = instId
                    promise = this.searchSet({
                        bizId: this.bizId,
                        params: requestParams,
                        config: requestConfig
                    })
                } else if (objId === 'module') {
                    requestParams.condition['module_id'] = instId
                    requestParams.condition['org_id'] = this.supplierAccount
                    promise = this.searchModule({
                        bizId: this.bizId,
                        setId: this.tree.selectedNodeState.parent.node['inst_id'],
                        params: requestParams,
                        config: requestConfig
                    })
                } else {
                    requestParams.fields = {}
                    requestParams.condition[objId] = [{
                        field: 'inst_id',
                        operator: '$eq',
                        value: instId
                    }]
                    promise = this.searchInst({
                        objId,
                        params: this.$injectMetadata(requestParams),
                        config: requestConfig
                    })
                }
                promise.then(data => {
                    this.tree.selectedNodeInst = data.info[0]
                    this.tree.flatternedSelectedNodeInst = this.$tools.flatternItem(this.tab.properties, data.info[0])
                })
            },
            getMainlineModel () {
                return this.searchMainlineObject({
                    config: {
                        requestId: 'get_searchMainlineObject'
                    }
                }).then(topoModel => {
                    this.topoModel = topoModel
                    return topoModel
                })
            },
            getBusinessTopo () {
                return Promise.all([
                    this.getInstTopo({
                        bizId: this.bizId,
                        config: {
                            requestId: `get_getInstTopo_${this.bizId}`,
                            cancelPrevious: true
                        }
                    }),
                    this.getInternalTopo({
                        bizId: this.bizId,
                        config: {
                            requestId: `get_getInternalTopo_${this.bizId}`,
                            cancelPrevious: true
                        }
                    })
                ]).then(([instTopo, internalTopo]) => {
                    const moduleModel = this.getModelByObjId('module')
                    const internalModule = (internalTopo.module || []).map(module => {
                        return {
                            'default': ['空闲机', 'idle machine'].includes(module['module_name']) ? 1 : 2,
                            'obj_id': 'module',
                            'obj_name': moduleModel['obj_name'],
                            'inst_id': module['module_id'],
                            'inst_name': module['module_name']
                        }
                    })
                    this.tree.internalModule = internalModule
                    this.tree.data = [{
                        selected: true,
                        expanded: true,
                        ...instTopo[0],
                        child: [...internalModule, ...instTopo[0].child]
                    }]
                })
            },
            getModelByObjId (id) {
                return this.topoModel.find(model => model['obj_id'] === id)
            },
            getTopoNodeId (node) {
                return `${node['obj_id']}-${node['inst_id']}`
            },
            handleNodeSelected (node, state) {
                this.tree.selectedNode = node
                this.tree.selectedNodeState = state
                const activeTab = this.tab.active
                if (activeTab === 'attribute') {
                    this.tab.type = 'details'
                    this.handleTabChanged(activeTab)
                } else if (activeTab === 'hosts') {
                    this.$refs.topoTable.table.checked = []
                    this.setSearchParams()
                    this.handleRefresh()
                }
            },
            handleQuickSearch (property, value, operator) {
                this.table.quickSearch.property = property
                this.table.quickSearch.value = value
                this.table.quickSearch.operator = operator
                this.setSearchParams()
                this.handleRefresh()
            },
            handleRefresh (resetPage = true) {
                this.$refs.topoTable.search(this.bizId, this.table.params, true)
            },
            setSearchParams () {
                const necessaryObj = ['host', 'module', 'set', 'biz']
                const condition = necessaryObj.map(objId => {
                    return {
                        'obj_id': objId,
                        condition: [],
                        fields: []
                    }
                })
                const params = {
                    ip: {
                        data: [],
                        exact: 0,
                        flag: 'host_innerip|host_outerip'
                    },
                    condition
                }
                const quickSearch = this.table.quickSearch
                if (quickSearch.property && quickSearch.value !== null && String(quickSearch.value).length) {
                    const quickSearchType = quickSearch.property['property_type']
                    const hostCondition = condition.find(condition => condition['obj_id'] === 'host')
                    if (['date', 'time'].includes(quickSearchType)) {
                        hostCondition.condition.push({
                            field: quickSearch.property['property_id'],
                            operator: '$gte',
                            value: quickSearch.value[0]
                        })
                        hostCondition.condition.push({
                            field: quickSearch.property['property_id'],
                            operator: '$lte',
                            value: quickSearch.value[1]
                        })
                    } else {
                        hostCondition.condition.push({
                            field: quickSearch.property['property_id'],
                            operator: quickSearch.operator,
                            value: quickSearch.value
                        })
                    }
                }
                const selectedNodeObjId = this.tree.selectedNode['obj_id']
                if (['module', 'set'].includes(selectedNodeObjId)) {
                    const objCondition = condition.find(meta => meta['obj_id'] === selectedNodeObjId)
                    objCondition.condition.push({
                        field: `bk_${selectedNodeObjId}_id`,
                        operator: '$eq',
                        value: this.tree.selectedNode['inst_id']
                    })
                } else if (!necessaryObj.includes(selectedNodeObjId)) {
                    condition.push({
                        'obj_id': 'object',
                        condition: [{
                            field: 'inst_id',
                            operator: '$eq',
                            value: this.tree.selectedNode['inst_id']
                        }],
                        fields: []
                    })
                }
                this.table.params = params
            },
            async handleTabChanged (active) {
                const selectedNode = this.tree.selectedNode
                if (this.showAttributePanel && active === 'attribute') {
                    if (this.tab.type === 'details') {
                        const [, properties] = await this.getNodeObjPropertyInfo(selectedNode['obj_id'])
                        this.tab.properties = properties
                        await this.getNodeInst()
                    } else {
                        const model = this.topoModel.find(model => model['obj_id'] === selectedNode['obj_id'])
                        await this.getNodeObjPropertyInfo(model['bk_next_obj'])
                        this.tree.selectedNodeInst = {}
                        this.tree.flatternedSelectedNodeInst = {}
                    }
                } else {
                    this.tab.type = 'details'
                    this.tree.selectedNodeInst = {}
                    this.tree.flatternedSelectedNodeInst = {}
                    if (active === 'hosts') {
                        this.handleRefresh()
                    }
                }
            },
            handleEdit () {
                this.tab.type = 'update'
            },
            async handleCreate () {
                this.tree.create.showDialog = true
                this.tree.create.active = true
                const targetNode = this.tree.selectedNode
                const model = this.topoModel.find(model => model['obj_id'] === targetNode['obj_id'])
                const properties = await this.getCommonProperties(model['bk_next_obj'])
                this.tree.create.properties = properties
            },
            handleCreateNode (values) {
                this.createNode(values).then(() => {
                    this.handleCancelCreateNode()
                })
            },
            handleCancelCreateNode () {
                this.tree.create.showDialog = false
            },
            handleAfterCancelCreateNode () {
                this.tree.create.active = false
                this.tree.create.properties = []
            },
            handleSubmit (value, changedValue, originalInst, type) {
                const promise = type === 'create' ? this.createNode(value) : this.updateNode(value)
                promise.then(() => {
                    this.$http.cancelCache('getInstTopo')
                })
            },
            createNode (value) {
                const selectedNode = this.tree.selectedNode
                const selectedNodeModel = this.topoModel.find(model => model['obj_id'] === selectedNode['obj_id'])
                const nextObjId = selectedNodeModel['bk_next_obj']
                const formData = this.$injectMetadata({
                    ...value,
                    'biz_id': this.bizId,
                    'bk_parent_id': selectedNode['inst_id']
                })
                let promise
                let instIdKey
                let instNameKey
                if (nextObjId === 'set') {
                    formData['org_id'] = this.supplierAccount
                    instIdKey = 'set_id'
                    instNameKey = 'set_name'
                    promise = this.createSet({
                        bizId: this.bizId,
                        params: formData
                    })
                } else if (nextObjId === 'module') {
                    formData['org_id'] = this.supplierAccount
                    instIdKey = 'module_id'
                    instNameKey = 'module_name'
                    promise = this.createModule({
                        bizId: this.bizId,
                        setId: selectedNode['inst_id'],
                        params: formData
                    })
                } else {
                    instIdKey = 'inst_id'
                    instNameKey = 'inst_name'
                    promise = this.createInst({
                        objId: nextObjId,
                        params: this.$injectMetadata(formData)
                    })
                }
                promise.then(inst => {
                    const children = selectedNode.child || []
                    const newNode = {
                        default: 0,
                        child: [],
                        'inst_id': inst[instIdKey],
                        'inst_name': inst[instNameKey],
                        'obj_id': nextObjId,
                        'obj_name': selectedNodeModel['bk_next_name']
                    }
                    if (selectedNode['obj_id'] === 'biz') {
                        children.splice(2, 0, newNode)
                    } else {
                        children.unshift(newNode)
                    }
                    this.$set(selectedNode, 'child', children)
                    this.$set(selectedNode, 'expanded', true)
                    this.tab.active = 'hosts'
                    this.tab.type = 'details'
                    this.$success(this.$t('Common[\'新建成功\']'))
                })
                return promise
            },
            updateNode (value) {
                const formData = this.$injectMetadata({ ...value })
                const selectedNode = this.tree.selectedNode
                const objId = selectedNode['obj_id']
                let promise
                if (objId === 'set') {
                    formData['org_id'] = this.supplierAccount
                    promise = this.updateSet({
                        bizId: this.bizId,
                        setId: selectedNode['inst_id'],
                        params: formData
                    })
                } else if (objId === 'module') {
                    formData['org_id'] = this.supplierAccount
                    promise = this.updateModule({
                        bizId: this.bizId,
                        setId: this.tree.selectedNodeInst['set_id'],
                        moduleId: selectedNode['inst_id'],
                        params: formData
                    })
                } else {
                    promise = this.updateInst({
                        objId: objId,
                        instId: selectedNode['inst_id'],
                        params: formData
                    })
                }
                promise.then(() => {
                    const instNameKey = ['set', 'module'].includes(objId) ? `bk_${objId}_name` : 'inst_name'
                    selectedNode['inst_name'] = formData[instNameKey]
                    this.tree.selectedNodeInst = {
                        ...this.tree.selectedNodeInst,
                        ...value
                    }
                    this.tree.flatternedSelectedNodeInst = {
                        ...this.tree.flatternedSelectedNodeInst,
                        ...this.$tools.flatternItem(this.tab.properties, value)
                    }
                    this.tab.type = 'details'
                    this.$success(this.$t('Common[\'修改成功\']'))
                })
                return promise
            },
            handleCancel () {
                if (this.tab.type === 'update') {
                    this.tab.type = 'details'
                } else {
                    this.tab.active = 'hosts'
                    this.tab.type = 'update'
                }
            },
            handleDelete () {
                const selectedNode = this.tree.selectedNode
                const parentNode = this.tree.selectedNodeState.parent.node
                const objId = selectedNode['obj_id']
                const config = { requestId: 'deleteNode', data: this.$injectMetadata({}) }
                this.$bkInfo({
                    title: `${this.$t('Common["确定删除"]')} ${selectedNode['inst_name']}?`,
                    content: objId === 'module'
                        ? this.$t('Common["请先转移其下所有的主机"]')
                        : this.$t('Common[\'下属层级都会被删除，请先转移其下所有的主机\']'),
                    confirmFn: () => {
                        let promise
                        if (objId === 'set') {
                            promise = this.deleteSet({
                                bizId: this.bizId,
                                setId: selectedNode['inst_id'],
                                config
                            })
                        } else if (objId === 'module') {
                            promise = this.deleteModule({
                                bizId: this.bizId,
                                setId: parentNode['inst_id'],
                                moduleId: selectedNode['inst_id'],
                                config
                            })
                        } else {
                            promise = this.deleteInst({
                                objId,
                                instId: selectedNode['inst_id'],
                                config
                            })
                        }
                        promise.then(() => {
                            parentNode.child = parentNode.child.filter(node => node !== selectedNode)
                            this.tab.active = 'hosts'
                            this.$refs.topoTree.selectNode(this.getTopoNodeId(this.tree.data[0]))
                            this.$success(this.$t('Common[\'删除成功\']'))
                        })
                    }
                })
            },
            showCreate (node, state) {
                const selected = state.selected
                const isBlueKing = this.tree.data[0]['inst_name'] === '蓝鲸'
                const isModule = node['obj_id'] === 'module'
                return !this.isAdminView && selected && !isBlueKing && !isModule
            }
        }
    }
</script>

<style lang="scss" scoped>
    .topology-layout{
        padding: 0;
        height: 100%;
    }
    .tree-layout{
        width: 280px;
        height: 100%;
        border-right: 1px solid $cmdbBorderColor;
        background-color: #fafbfd;
        .business-selector{
            display: block;
            width: auto;
            margin: 20px 20px 13px;
        }
        .topo-tree{
            padding: 0 0 0 20px;
            margin: 10px 0 0 0;
            height: calc(100% - 20px);
            @include scrollbar-y;
            .tree-node {
                font-size: 0;
                &:hover{
                    .topo-node-icon.topo-node-icon-text{
                        background-color: #50abff;
                    }
                    .topo-node-icon.topo-node-icon-internal{
                        color: #50abff;
                    }
                }
                &.tree-node-selected {
                    .topo-node-icon.topo-node-icon-text {
                        background-color: #498fe0;
                    }
                    .topo-node-icon.topo-node-icon-internal {
                        color: #ffb400;
                    }
                }
                &.tree-node-selected:not(.tree-node-module) {
                    .topo-node-text {
                        max-width: calc(100% - 65px);
                    }
                }
            }
            .topo-node-icon{
                display: inline-block;
                vertical-align: middle;
                width: 18px;
                height: 18px;
                line-height: 16px;
                font-size: 12px;
                text-align: center;
                color: #fff;
                font-style: normal;
                background-color: #c3cdd7;
                border-radius: 50%;
                &.topo-node-icon-internal{
                    font-size: 16px;
                    color: $cmdbTextColor;
                    background-color: transparent;
                }
            }
            .topo-node-text{
                display: inline-block;
                vertical-align: middle;
                max-width: calc(100% - 18px);
                padding: 0 0 0 8px;
                font-size: 14px;
                @include ellipsis;
            }
            .topo-node-btn-create{
                width: auto;
                height: 18px;
                padding: 0 6px;
                margin: 3px 4px;
                line-height: 16px;
                border-radius: 4px;
                font-size: 12px;
            }
        }
    }
    .hosts-layout{
        overflow: hidden;
        padding: 0 20px;
        height: 100%;
        .topo-tabpanel{
            padding: 20px 0 0 0;
            position: relative;
            .topo-table-btn-refresh{
                position: absolute;
                top: 20px;
                right: 0;
            }
        }
        .options{
            margin: 30px 0 0 150px;
        }
    }
    .topology-details {
        max-width: 700px;
    }
</style>
